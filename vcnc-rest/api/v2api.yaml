#
#  Copyright (C) 2015-2017 IC Manage Inc.
#
#  See the file 'COPYING' for license information.
#
#  This file may be validated and viewed in a more readable form at
#  http://editor.swagger.io/#!/
#
swagger: '2.0'

#
#  JSON structure:
#    In response bodies, the returned data is packaged into a single key that is a sibling of 'error_sym'.
#    Everywhere else, we prefer to avoid creating hierarchy.  Hierarchy complicates object manipulation in the browser.

# Document metadata
info:
  version: "2.0.0"
  title: Velstor vCNC API
  description: |
    ### Admin API

    The Admin API manages the vCNC server itself.

    ### vTRQ API

    The vTRQ API performs operations on a vTRQ.

    Errors are reported at two levels: HTTP and operational.  With one exception, HTTP error codes represent the success or failure of the HTTP protocol, considered solely as a transport. Operational error codes, reported in the response body, reflect the success or failure of the operation itself.

    The exception is the operational error code __ENOENT__ (Does not exist).  REST operations which refer to exactly one resource in the URL convert __ENOENT__ to HTTP 404.  Doing so improves our compliance with [*HTTP/1.1*](http://tools.ietf.org/html/rfc7231).  Refer to the [vCNC API Overview](../api-overview.html) for a more detailed discussion.

# Array of all schemes the API supports.
schemes:
  - http

# will be prefixed to all paths
basePath: /v2

# API request and response bodies are always JSON
consumes:
  - application/json
produces:
  - application/json

#
#  Endpoint definitions
#
paths:
  ##
  ##  Authorization and session security
  ##
  /auth/token:
    post:
      summary: Returns a session authorization token
      description: Not yet finalized or implemented.
      operationId: login
      tags:
        - "Admin API"
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: body
          name: body
          description: "User's name and password on the vCNC server."
          required: true
          schema:
            $ref: '#/definitions/UsernamePassword'
      responses:
        '200':
          description: Session token
          schema:
            $ref: '#/definitions/SessionToken'
        default:
          description: unexpected error
          schema:
            $ref: '#/definitions/Error'
    delete:
      summary: Ends a user session
      description: Not yet finalized or implemented.
      operationId: logout
      tags:
        - "Admin API"
      produces:
        - application/json
      parameters:
        - in: header
          name: "Authorization"
          description: JWT session token
          required: true
          type: string
      responses:
        '200':
          description: Request processed.  See response body.
        default:
          description: HTTP error
          schema:
            $ref: '#/definitions/Error'

  ##
  ##  Grid computing support
  ##
  /grid/jobs:
    get:
      summary: Retrieves information about all jobs
      operationId: gridJobList
      tags:
        - 'Grid API'
      responses:
        '200':
          description: Request processed.  See response body.
          schema:
            required:
              - error_sym
            properties:
              error_sym:
                type: string
                description: Symbolic error code value
                default: OK
                enum:
                  - OK
                  - EACCES
                  - ENOENT
                  - EREMOTEIO
              jobs:
                type: array
                items:
                  $ref: '#/definitions/GridJobInfo'
        default:
          description: unexpected error
          schema:
            $ref: '#/definitions/Error'

  /grid/job/{job_id}:
    post:
      summary: Creates a new resource describing a job with the specified id.
      operationId: gridJobPost
      tags:
        - "Grid API"
      parameters:
        - in: path
          name: job_id
          description: ID of grid job
          required: true
          type: string
        - in: body
          name: body
          description: Information about a grid job
          required: true
          schema:
            type: object
            properties:
              vtrq_id:
                description: ID of the vTRQ performing this operation.
                type: integer
                format: int64
                minimum: 0
                maximum: 1073741823
                default: 0
              workspace_name:
                type: string
            required:
              - workspace_name
            additionalProperties: false
      responses:
        '200':
          description: Request processed.  See response body.
        default:
          description: unexpected error
          schema:
            $ref: '#/definitions/Error'

    get:
      summary: Retrieves data associated with a grid job.
      operationId: gridJobGet
      tags:
        - "Grid API"
      produces:
        - application/json
      parameters:
        - in: path
          name: job_id
          description: ID of grid job
          required: true
          type: string
      responses:
        '200':
          description: Request processed.  See response body.
          schema:
            required:
              - error_sym
              - job
            properties:
              error_sym:
                type: string
                description: Symbolic error code value
                default: OK
                enum:
                  - OK
                  - EACCES
                  - ENOENT
                  - EREMOTEIO
              job:
                $ref: '#/definitions/GridJobInfo'
        default:
          description: unexpected error
          schema:
            $ref: '#/definitions/Error'

    delete:
      summary: Deletes data associated with a grid job.
      operationId: gridJobDelete
      tags:
        - "Grid API"
      parameters:
        - in: path
          name: job_id
          description: ID of grid job
          required: true
          type: string
      responses:
        '200':
          description: Request processed.  See response body.
        default:
          description: unexpected error
          schema:
            $ref: '#/definitions/Error'
  ##
  ##  vCNC - users
  ##
  /vcnc/users:
    post:
      summary: Creates a new vCNC user and assigns the initial password
      description: Not yet finalized or implemented.
      operationId: vcncUserCreate
      tags:
        - "Admin API"
      consumes:
        - application/json
      parameters:
        - in: body
          name: body
          description: "User's new password on the vCNC server."
          required: true
          schema:
            $ref: '#/definitions/UsernamePassword'
        - in: header
          name: "Authorization"
          description: JWT session token
          required: true
          type: string
      responses:
        '200':
          description: Request processed.  See response body.
        default:
          description: unexpected error
          schema:
            $ref: '#/definitions/Error'

  /vcnc/user/{username}:
    put:
      summary: Updates information about a vCNC user.
      description: Not yet finalized or implemented.
      operationId: vcncUserUpdate
      tags:
        - "Admin API"
      parameters:
        - in: path
          name: username
          description: Name of user.
          required: true
          type: string
        - in: body
          name: body
          description: "User's new password on the vCNC server."
          required: true
          schema:
            type: object
            properties:
              password:
                type: string
            required:
              - password
            additionalProperties: false
        - in: header
          name: "Authorization"
          description: JWT session token
          required: true
          type: string
      responses:
        '200':
          description: Request processed.
        default:
          description: HTTP error
          schema:
            $ref: '#/definitions/Error'

    delete:
      summary: Deletes a vCNC user
      description: Not yet finalized or implemented.
      operationId: vcncUserDelete
      tags:
        - "Admin API"
      parameters:
        - in: path
          name: username
          description: Name of user to be deleted.
          required: true
          type: string
        - in: header
          name: "Authorization"
          description: JWT session token
          required: true
          type: string
      responses:
        '200':
          description: Request processed.
        default:
          description: HTTP error
          schema:
            $ref: '#/definitions/Error'

  ##
  ##  vTRQ
  ##
  /vtrq/{vtrq_id}/delete_nodes:
    post:
      summary: Performs a vector of deletions in a vTRQ namespace
      tags:
        - "vTRQ Namespace"
      operationId: vtrqDeleteNodes
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: path
          name: vtrq_id
          description: ID of the vTRQ performing this operation.
          required: true
          type: integer
          format: int64
          minimum: 0
          maximum: 1073741823
        - in: query
          name: recursive
          required: false
          type: boolean
          default: false
        - in: body
          name: body
          description: "Array of deletion requests."
          required: true
          schema:
            $ref: '#/definitions/DeleteNodesRequest'
      responses:
        '200':
          description: Request processed, see response body.
          schema:
            $ref: '#/definitions/DeleteNodesResponse'
        default:
          description: HTTP error
          schema:
            $ref: '#/definitions/Error'

  /vtrq/{vtrq_id}/meta_copy:
    post:
      summary: Performs a vector of meta-data copies
      description: |
        Performs internal "meta-data" copies of one part of the vTRQ namespace to another.

        If the source path is a directory and the destination path exists, the copy is not performed and the error code is set to __EEXIST__.

        If the source path is a file and the destination path is an existing directory, the copy is not performed and the error code is set to __EEXIST__.

        When both the source path and destination path are existing files, the behavior depends on the value of "overwrite". If true, the file at the destination path is atomically changed to be the file at the source path. Otherwise, the copy is not performed and the error code is set to __EEXIST__.

        Metadata copies are performed on the server in no particular order. The return JSON object pairs each metacopy request with its resulting error code. The array is in no particular order; specifically, it may or may not be in the order it was executed on the vTRQ.

      tags:
        - "vTRQ Namespace"
      operationId: vtrqMetaCopy
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: path
          name: vtrq_id
          description: ID of the vTRQ performing this operation.
          required: true
          type: integer
          format: int64
          minimum: 0
          maximum: 1073741823
        - in: query
          name: overwrite
          required: false
          type: boolean
          default: false
        - in: body
          name: body
          description: "Array of meta-copy requests."
          required: true
          schema:
            $ref: '#/definitions/MetaCopyRequest'
      responses:
        '200':
          description: Request processed, see response body.
          schema:
            $ref: '#/definitions/MetaCopyResponse'
        default:
          description: HTTP error
          schema:
            $ref: '#/definitions/Error'


  /vtrq/{vtrq_id}/namespace/{url_path}:
    delete:
      summary: Deletes the node at the specified paath.
      operationId: vtrqNamespaceDelete
      tags:
        - "vTRQ Namespace"
      parameters:
        - in: path
          name: vtrq_id
          description: ID of the vTRQ performing this operation.
          required: true
          type: integer
          format: int64
          minimum: 0
          maximum: 1073741823
        - in: path
          name: url_path
          description: URL-encoded path in the vTRQ namespace.
          required: true
          type: string
          format: url-path
        - in: query
          name: recursive
          required: false
          type: boolean
          default: false
      responses:
        '200':
          description: Request processed.  See response body.
          schema:
            $ref: '#/definitions/ErrorVtrq'
        default:
          description: HTTP error
          schema:
            $ref: '#/definitions/Error'

    get:
      summary: Returns meta-data about the specified path
      description: "The returned content resembles that of 'struct stat' on Unix systems."

      operationId: vtrqNamespaceGet
      tags:
        - "vTRQ Namespace"
      parameters:
        - in: path
          name: vtrq_id
          description: ID of the vTRQ performing this operation.
          required: true
          type: integer
          format: int64
          minimum: 0
          maximum: 1073741823
        - in: path
          name: url_path
          description: URL-encoded path in the vTRQ namespace.
          required: true
          type: string
          format: url-path
      responses:
        '200':
          description: Request processed.  See response body.
          schema:
            required:
              - error_sym
            properties:
              error_sym:
                type: string
                description: Symbolic error code value
                default: OK
                enum:
                  - OK
                  - EACCESS
                  - EREMOTEIO
              stat:
                $ref: '#/definitions/NodeInfo'
        default:
          description: HTTP error
          schema:
            $ref: '#/definitions/Error'

  /vtrq/{vtrq_id}/namespace/{url_path}/children:
    get:
      summary: Returns the child nodes of a namespace path
      operationId: vtrqNamespaceChildren
      tags:
        - "vTRQ Namespace"
      parameters:
        - in: path
          name: vtrq_id
          description: ID of the vTRQ performing this operation.
          required: true
          type: integer
          format: int64
          minimum: 0
          maximum: 1073741823
        - in: path
          name: url_path
          description: URL-encoded path in the vTRQ namespace.
          required: true
          type: string
        - in: query
          name: details
          description: If false the 'stat' field will not be returned.
          required: false
          type: boolean
          default: false
      responses:
        '200':
          description: Request processed.  See response body.
          schema:
            type: object
            required:
              - error_sym
              - result
            properties:
              error_sym:
                type: string
                default: OK
              result:
                type: array
                items:
                  $ref: '#/definitions/NodeInfo'
            additionalProperties: false
        default:
          description: HTTP error
          schema:
            $ref: '#/definitions/Error'

  /vtrq/{vtrq_id}/namespace/{url_path}/mkdir:
    post:
      summary: Creates a directory at a namespace path.
      description: Clients must ensure the parent exists and is a directory.
      operationId: vtrqNamespaceMkdir
      tags:
        - "vTRQ Namespace"
      parameters:
        - in: path
          name: vtrq_id
          description: ID of the vTRQ performing this operation.
          required: true
          type: integer
          format: int64
          minimum: 0
          maximum: 1073741823
        - in: path
          name: url_path
          description: URL-encoded path in the vTRQ namespace.
          required: true
          type: string
        - in: query
          name: mode
          description: "File access bits (decimal)"
          required: false
          type: integer
          format: int32
          default: 429
        - in: query
          name: parents
          description: When 'true', creates parent directories as necessary.
          required: false
          type: boolean
          default: false
      responses:
        '200':
          description: Request processed. See response body.
          schema:
            required:
              - error_sym
            properties:
              error_sym:
                type: string
                description: Symbolic error code value
                default: OK
                enum:
                  - OK
                  - EACCESS
                  - ENOENT
                  - ENOTDIR
                  - ENAMETOOLONG
                  - EEXIST
                  - ENOSPC
                  - EREMOTEIO
        default:
          description: HTTP error
          schema:
            $ref: '#/definitions/Error'

  /vtrq/{vtrq_id}/service:
    delete:
      summary: Gracefully brings down a vTRQ
      operationId: vtrqShutdown
      tags:
        - "vTRQ Services"
      parameters:
        - in: path
          name: vtrq_id
          description: ID of the vTRQ performing this operation.
          required: true
          type: integer
          format: int64
          minimum: 0
          maximum: 1073741823
      responses:
        '202':
          description: Request accepted. Client may receive the HTTP response before the vTRQ has fully shut down.
          schema:
            properties:
              error_sym:
                type: string
                description: Symbolic error code value
                default: OK
                enum:
                  - OK
            required:
              - error_sym
            additionalProperties: false
        default:
          description: HTTP error
          schema:
            $ref: '#/definitions/Error'

  /vtrq/{vtrq_id}/vp/{vp_id}:
    get:
      summary: Returns information about a VP instance
      operationId: vpGet
      tags:
        - "VP Instances"
      parameters:
        - in: path
          name: vtrq_id
          description: ID of the vTRQ performing this operation.
          required: true
          type: integer
          format: int64
          minimum: 0
          maximum: 1073741823
        - in: path
          name: vp_id
          description: VP instance ID
          required: true
          type: string
      responses:
        '200':
          description: Request processed. See response body.
          schema:
            required:
              - error_sym
              - vp
            properties:
              error_sym:
                type: string
                description: Symbolic error code value
                default: OK
                enum:
                  - OK
                  - EACCESS
                  - EREMOTEIO
              vp:
                $ref: '#/definitions/VpInstance'
        default:
          description: HTTP error
          schema:
            $ref: '#/definitions/Error'
    delete:
      summary: Disconnects a VP instance from all servers.
      operationId: vpDelete
      tags:
        - "VP Instances"
      parameters:
        - in: path
          name: vtrq_id
          description: ID of the vTRQ performing this operation.
          required: true
          type: integer
          format: int64
          minimum: 0
          maximum: 1073741823
        - in: path
          name: vp_id
          description: VP instance ID
          required: true
          type: string
      responses:
        '200':
          description: Request processed. See response body.
          schema:
            required:
              - error_sym
            properties:
              error_sym:
                type: string
                description: Symbolic error code value
                default: OK
                enum:
                  - OK
                  - EACCESS
                  - EREMOTEIO
        default:
          description: HTTP error
          schema:
            $ref: '#/definitions/Error'

  /vtrq/{vtrq_id}/vps:
    get:
      summary: Finds VP instances matching certain criteria
      description: |
        The result body contains the id of every VP which matches all (logical AND) of the search parameters. Matching is based on simple string equality.

        If the request body contains no parameters, every VP id is returned.

      operationId: vpFind
      tags:
        - "VP Instances"
      parameters:
        - in: path
          name: vtrq_id
          description: ID of the vTRQ performing this operation.
          required: true
          type: integer
        - in: query
          name: vp_host
          description: Hostname of the machine running the VP
          required: false
          type: string
        - in: query
          name: mount_point
          description: Fully qualified canonical path to the VP mount point.
          required: false
          type: string
      responses:
        '200':
          description: Request processed, see response body.
          headers:
            Location:
              description: URL of a cursor resource.
              type: string
          schema:
            required:
              - error_sym
            properties:
              error_sym:
                $ref: '#/definitions/ErrorSymbol'
              vps:
                type: array
                description: ""
                items:
                  $ref: '#/definitions/VpInstance'
        default:
          description: HTTP error
          schema:
            $ref: '#/definitions/Error'

  /vtrq/{vtrq_id}/workspace/{url_path}:
    put:
      summary: Updates a workspace
      operationId: vtrqWorkspaceUpdate
      tags:
        - "vTRQ Workspaces"
      parameters:
        - in: path
          name: vtrq_id
          description: ID of the vTRQ performing this operation.
          required: true
          type: integer
        - in: path
          name: url_path
          description: URL-encoded hierarchial name of the workspace.
          required: true
          type: string
        - in: query
          name: push
          description: "'true' if active VPs should switch to the new spec."
          required: false
          type: boolean
          default: false
        - in: body
          name: body
          description: "Workspace Specification"
          required: true
          schema:
            $ref: '#/definitions/Workspace'
      responses:
        '200':
          description: Request processed. See response body.
          schema:
            required:
              - error_sym
            properties:
              error_sym:
                type: string
                description: Symbolic error code value
                default: OK
                enum:
                  - OK
                  - EACCESS
                  - EREMOTEIO
        default:
          description: HTTP error
          schema:
            $ref: '#/definitions/Error'

    delete:
      summary: Deletes a workspace
      operationId: vtrqWorkspaceDelete
      tags:
        - "vTRQ Workspaces"
      parameters:
        - in: path
          name: vtrq_id
          description: ID of the vTRQ performing this operation.
          required: true
          type: integer
        - in: path
          name: url_path
          description: URL-encoded hierarchial name of the workspace.
          required: true
          type: string
      responses:
        '200':
          description: Request processed, see response body.
          schema:
            required:
              - error_sym
            properties:
              error_sym:
                type: string
                description: Symbolic error code value
                default: OK
                enum:
                  - OK
                  - EACCES
                  - ENOENT
                  - EREMOTEIO
        default:
          description: HTTP error
          schema:
            $ref: '#/definitions/Error'

    get:
      summary: Returns the workspace specification at this path
      operationId: vtrqWorkspaceGet
      tags:
        - "vTRQ Workspaces"
      parameters:
        - in: path
          name: vtrq_id
          description: ID of the vTRQ performing this operation.
          required: true
          type: integer
        - in: path
          name: url_path
          description: URL-encoded hierarchial name of the workspace.
          required: true
          type: string
      responses:
        '200':
          description: Request processed, see response body.
          schema:
            type: object
            required:
              - error_sym
              - workspace
            properties:
              error_sym:
                type: string
                description: Symbolic error code value
                default: OK
                enum:
                  - OK
                  - EACCES
                  - ENOENT
                  - EREMOTEIO
              workspace:
                $ref: '#/definitions/Workspace'
            additionalProperties: false
        default:
          description: HTTP error
          schema:
            $ref: '#/definitions/Error'

  /vtrq/{vtrq_id}/workspace/{url_path}/children:
    get:
      summary: Returns child nodes of a workspace path
      description: |
        Workspaces are organized into a hierarchical namespace. A child
        workspace having only a 'name' key represents an additional level of
        hierarchy. A child workspace having a 'name' key and also other keys
        is a workspace.

      operationId: vtrqWorkspaceChildren
      tags:
        - "vTRQ Workspaces"
      parameters:
        - in: path
          name: vtrq_id
          description: ID of the vTRQ performing this operation.
          required: true
          type: integer
        - in: path
          name: url_path
          description: URL-encoded hierarchial name of the workspace.
          required: true
          type: string
        - in: query
          name: details
          required: false
          type: boolean
          default: false
      responses:
        '200':
          description: Request processed, see response body.
          schema:
            required:
              - error_sym
            properties:
              error_sym:
                type: string
                description: Symbolic error code value
                default: OK
                enum:
                  - OK
                  - EACCES
                  - ENOENT
                  - EREMOTEIO
              children:
                type: array
                items:
                  $ref: '#/definitions/Workspace'
        default:
          description: HTTP error
          schema:
            $ref: '#/definitions/Error'

  /vtrq/{vtrq_id}/workspaces:
    post:
      summary: Creates or updates a workspace
      operationId: vtrqWorkspaceCreate
      tags:
        - "vTRQ Workspaces"
      parameters:
        - in: path
          name: vtrq_id
          description: ID of the vTRQ performing this operation.
          required: true
          type: integer
        - in: query
          name: overwrite
          description: "'true' if an existing workspace should be overwritten."
          required: false
          type: boolean
          default: false
        - in: query
          name: push
          description: "'true' if active VPs should switch to the new spec."
          required: false
          type: boolean
          default: false
        - in: body
          name: body
          description: "Workspace Specification"
          required: true
          schema:
            $ref: '#/definitions/Workspace'
      responses:
        '200':
          description: Request processed. See response body.
          schema:
            $ref: '#/definitions/Error'
        default:
          description: HTTP error
          schema:
            $ref: '#/definitions/Error'

  /_test/latency:
    post:
      summary: Tests 202 latency mechanism
      operationId: _testLatency
      tags:
        - "Internal API"
        - "Tests"
      parameters:
        - in: query
          name: latency
          description: Number of seconds needed to fulfill
          required: true
          type: integer
        - in: query
          name: input
          description: Integer input value
          required: true
          type: integer
      responses:
        '200':
          description: Completed

#
#  Re-usable object definitions.
#
definitions:

  DeleteNodesRequest:
    type: object
    properties:
      delete_paths:
        type: array
        items:
          type: string
          example: /path/on/vtrq_host
    required:
      - delete_paths
    additionalProperties: false

  DeleteNodesResponse:
    type: object
    properties:
      result:
        type: array
        items:
          type: object
          properties:
            error_sym:
              type: string
              description: Symbolic error code value
              default: OK
              #  this enum needs more codes
              enum:
                - OK
                - EACCESS
                - EREMOTEIO
            path:
              type: string
              example: /path/on/vtrq_host
          required:
            - error_sym
            - path
          additionalProperties: false

  Error:
    required:
      - error_sym
      - message
    properties:
      error_sym:
        type: string
        example: OK
      message:
        type: string
        example: Request processed

  ErrorSymbol:
    type: string
    description: Symbolic error code value
    default: OK
    enum:
      - OK
      - EACCES
      - EEXIST
      - ENAMETOOLONG
      - ENOENT
      - ENOSPC
      - ENOTDIR
      - ENOTRECOVERABLE
      - EREMOTEIO

  ErrorVtrq:
    description: |
      vTRQ operational codes are returned to the REST interface as strings. The HHTP status code is '200', other than '404' for __ENOENT__ (Does not exist).

      Error | Description |
      --- | --- |
      __OK__ | Operation was successful.
      __EACCES__ | vCNC user does not have permission to perform operation on vTRQ.
      __EEXIST__ | Destination path exists and is a directory, or it is a file and the value of _overwrite_ is _false_.
      __ENOENT__ | Path does not exist. In most cases, reported as HTTP error 404.
      __ENOTDIR__ | Path is not a directory.
      __ENOTRECOVERABLE__ | vTRQ unable to make data safe; vTRQ is now in an unknown state.  Check the vTRQ logs for details.
      __EREMOTEIO__ | An unspecified communication error occurred.

      These error codes follow [IEEE Std 1003.1, 2013 Edition](http://pubs.opengroup.org/onlinepubs/9699919799/).

    required:
      - error_sym
      - message
    properties:
      error_sym:
        type: string
        description: Symbolic error code value
        default: OK
        enum:
          - OK
          - EACCES
          - EEXIST
          - ENAMETOOLONG
          - ENOENT
          - ENOSPC
          - ENOTDIR
          - ENOTRECOVERABLE
          - EREMOTEIO
      message:
        type: string

  GridJobInfo:
    type: object
    properties:
      id:
        description: Grid job identifier.
        type: string
        example: XYZ:1234
      vtrq_id:
        description: ID of the vTRQ performing this operation.
        type: integer
        format: int64
        minimum: 0
        maximum: 1073741823
        default: 0
      workspace_name:
        description: Name of the workspace used by the job
        type: string
        example: /path/to/workspace
      workspace_spec:
        description: Workspace specification used by the job
        type: string
        example:
          "{ \"maps\": [{\"vp_path\":\"/\", \"vtrq_id\":8, \"vtrq_path\":\"/\"}], \"writeback\": \"never\""
    required:
      - vtrq_id
      - workspace_name
      - workspace_spec
    additionalProperties: false

  MetaCopyRequest:
    type: object
    properties:
      copy_paths:
        $ref: '#/definitions/SourceDestinationVector'
    required:
      - copy_paths
    additionalProperties: false

  MetaCopyResponse:
    type: object
    properties:
      result:
        $ref: '#/definitions/SourceDestinationErrorVector'

  NodeInfo:
    description: Intentionally using 'name' rather than 'path', because this is used in a hierarchical context.
    type: object
    properties:
      name:
        type: string
        example: foo
      st_dev:
        type: string
        format: uint64
        example: "0x0000000000000000"
      st_ino:
        type: string
        format: uint64
        example: "0x0000000000000000"
      st_mode:
        type: integer
        format: int32
        example: 544
      st_nlink:
        type: string
        format: uint64
        example: "0x0000000000000000"
      st_uid:
        type: integer
        format: int32
        example: 101
      st_gid:
        type: integer
        format: int32
        example: 102
      st_rdev:
        type: string
        format: uint64
        example: "0x0000000000000000"
      st_size:
        type: string
        format: uint64
        example: "0x0000000000000000"
      st_blksize:
        type: string
        format: uint64
        example: "0x0000000000000000"
      st_blocks:
        type: string
        format: uint64
        example: "0x0000000000000000"
      st_atime:
        type: string
        format: date-time
        example: "2015-09-10T11:32:50.522Z"
      st_mtime:
        type: string
        format: date-time
        example: "2015-09-10T11:32:50.522Z"
      st_ctime:
        type: string
        format: date-time
        example: "2015-09-10T11:32:50.522Z"
    required:
      - st_dev
      - st_ino
      - st_mode
      - st_nlink
      - st_uid
      - st_gid
      - st_rdev
      - st_size
      - st_blksize
      - st_blocks
      - st_atime
      - st_mtime
      - st_ctime
    additionalProperties: false

  SourceDestinationPath:
    properties:
      src:
        type: string
        example: "/path/to/source"
      dest:
        type: string
        example: "/path/to/destination"
    required:
      - src
      - dest
    additionalProperties: false

  SourceDestinationVector:
    type: array
    items:
      $ref: '#/definitions/SourceDestinationPath'

  SourceDestinationErrorVector:
    type: array
    items:
      properties:
        error_sym:
          type: string
          example: OK
        copy:
          $ref: '#/definitions/SourceDestinationPath'
      required:
        - error_sym
        - copy
      additionalProperties: false

  SessionToken:
    properties:
      token:
        type: string

  UsernamePassword:
    type: object
    properties:
      username:
        type: string
      password:
        type: string
    required:
      - username
      - password
    additionalProperties: false

  VpInstance:
    type: object
    properties:
      host:
        type: string
        description: The hostanme of the machine running the vp process.
        example: jupiter
      id:
        type: string
        description: Opaquely identifies a mounted PeerCache filesystem.
        example: '123456789ABCDEF0'
      ip:
        type: string
        description: The IP address of the host running the vp process.
        example: 172.17.0.1
      job:
        type: string
        description: An arbitrary user-provided string, perhaps a grid job ID.
        example: DRC-0-0-0-0
      mount:
        type: string
        description: The absolute path at which the PeerCache filesystem is mounted.
        example: /tmp/mnt/0xABCDE
      os_user:
        type: string
        description: The effective user id on the host operating system.
        example: sally
      pc_user:
        type: string
        description: The PeerCache user id of the vp process.
        example: /engr/sally
    required:
      - host
      - id
      - ip
      - job
      - mount
      - os_user
      - pc_user

  WorkspaceEntry:
    type: object
    properties:
      vp_path:
        type: string
        example: /
      vtrq_id:
        type: integer
        format: int64
        minimum: 0
        maximum: 1073741823
        example: 10
      vtrq_path:
        type: string
        example: /path/within/vtrq10
    required:
      - vp_path
      - vtrq_id
      - vtrq_path
    additionalProperties: false

  Workspace:
    type: object
    properties:
      name:
        type: string
        example: myWorkspace
      maps:
        type: array
        items:
          $ref: '#/definitions/WorkspaceEntry'
      writeback:
        type: string
        description: Desired writeback semantics
        default: never
        enum:
          - never
          - explicit
          - trickle
          - always
    required:
      - maps
      - writeback
    additionalProperties: false

